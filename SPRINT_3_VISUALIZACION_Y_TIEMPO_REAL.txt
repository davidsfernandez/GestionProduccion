# Diseño de Sprint 3: Visualización y Tiempo Real (BI)

## Objetivo
Implementar el monitoreo en tiempo real mediante SignalR, el Modo TV para la planta y el Dashboard Gerencial con KPIs estratégicos.

## Tareas Detalladas
1. **Infraestructura Real-Time (SignalR):**
   - Creación del `ProductionHub` para notificaciones push.
   - Configuración de disparadores (Triggers) en el backend ante cambios de estado de producción.

2. **Modo TV (Floor Mode):**
   - Layout de alta visibilidad (`FloorLayout`).
   - Componentes de resumen de producción diaria y eficiencia.
   - Lógica de rotación automática (Auto-scroll) para listas extensas de órdenes.

3. **Motor Analítico (Backend):**
   - Servicio `AnalyticsService` para cálculo de KPIs (Margen, Costo Medio, Eficiencia).
   - Optimización de consultas SQL para agregaciones masivas.

4. **Dashboard Gerencial (UI):**
   - Rediseño estético del panel principal.
   - Integración de gráficos de tendencias y cuadrícula de KPIs.
   - Panel de alertas para modelos ineficientes y stock parado.

5. **Branding e Identidad:**
   - Inyección dinámica del Logo de Empresa en todos los layouts visuales.
   - Adaptación de colores según la configuración del sistema.

## Criterios de Aceptación
- Actualización instantánea (vía SignalR) en la TV tras cambios en producción.
- Legibilidad garantizada de métricas críticas a distancia (5m).
- KPIs financieros precisos y calculados directamente en base de datos.
- Reconexión automática de SignalR ante pérdida de señal.

Diseño del Sprint 3: Visualización y Tiempo Real (BI)


  Objetivo del Sprint:
  Implementar la infraestructura de comunicación en tiempo real (SignalR) y las interfaces críticas de monitoreo: el Modo TV (Floor Mode) para la 
  planta y el Dashboard Gerencial para la toma de decisiones estratégicas.

  ---


  Tarea 3.1: Infraestructura de Tiempo Real (SignalR Hub)
   * Acción: Implementar la capa de notificaciones push del servidor.
   * Lógica:
       * Crear el ProductionHub: Canal centralizado para eventos de producción.
       * Implementar métodos de difusión: NotifyProductionChange (para actualizar métricas) y NotifyEmergency (para alertas críticas).
       * Trigger: Configurar el sistema para que cualquier cambio en ProductionOrder o ProductionHistory dispare una notificación al Hub.
   * Archivos implicados: Hubs/ProductionHub.cs, Services/NotificationService.cs.


  Tarea 3.2: Modo TV (Floor Mode / FloorLayout)
   * Acción: Diseñar una interfaz de "Cero Interacción" y alta visibilidad.
   * Componentes:
       * FloorLayout.razor: Layout sin barras de navegación, optimizado para pantallas grandes.
       * ProductionSummaryCard.razor: Widgets de gran tamaño para "Producido Hoy" y "Meta".
       * LiveOrdersTable.razor: Tabla reactiva con los lotes en curso y sus estados.
       * Lógica de Auto-Scroll: Implementar un timer en JS/Blazor que rote la lista de órdenes si excede el espacio de pantalla (cada 15-20 seg). 
   * Archivos implicados: Client/Layout/FloorLayout.razor, Client/Pages/Production/FloorMode.razor.


  Tarea 3.3: Motor de Analíticas y KPIs (Backend)
   * Acción: Desarrollar los servicios de agregación de datos para el Dashboard.
   * Lógica:
       * AnalyticsService: Métodos optimizados que realicen GroupBy y Sum/Avg en la base de datos (evitando carga masiva en memoria).
       * Cálculo de Eficiencia del Equipo: Comparar el tiempo real de los lotes cerrados contra el tiempo de la "Memoria de Producción" (Sprint   
         2).
       * Identificación de Modelos a Descontinuar: Algoritmo que cruza rentabilidad vs. tasa de defectos (Sprint 4/5).
   * Archivos implicados: Services/AnalyticsService.cs, Models/DTOs/DashboardMetricsDto.cs.


  Tarea 3.4: Dashboard Gerencial Completo (Frontend)
   * Acción: Rediseñar el Dashboard principal con una estética moderna y funcional.
   * Componentes:
       * KpiGrid.razor: Tarjetas superiores con Margen Medio, Costo Medio y Atrasos.
       * ProductionChart.razor: Gráficos de barras y líneas (usando ChartJs.Blazor o similar) para tendencias mensuales.
       * AlertPanel.razor: Lista de modelos con bajo rendimiento y stock parado.
   * Archivos implicados: Client/Pages/Dashboard.razor, Client/Components/Charts/.


  Tarea 3.5: Personalización y Logotipos Dinámicos
   * Acción: Asegurar que la marca del cliente sea visible en todos los puntos críticos.
   * Lógica:
       * Inyectar el logotipo configurado en el FloorLayout (Modo TV) y en el sidebar del Dashboard.
       * Configurar el DashboardService para que el cliente pueda cambiar el nombre de la "Oficina/Taller" y se refleje en los títulos.

  ---


  Estrategia de Validación (Criterios de Aceptación)
   1. Latencia: Los cambios en la producción deben reflejarse en el Modo TV en menos de 2 segundos sin refrescar la página.
   2. Legibilidad: Las métricas críticas en la TV deben ser legibles a una distancia de 5 metros (fuentes grandes, alto contraste).
   3. Precisión: Los KPIs financieros deben coincidir con los cálculos manuales basados en los datos de los lotes cerrados.
   4. Resiliencia: Si la conexión a SignalR se pierde, el sistema debe intentar reconectarse automáticamente y notificar al usuario.

  ---


  Archivos que se verán afectados o creados:
   - Hubs/ProductionHub.cs (Nuevo)
   - Services/AnalyticsService.cs (Nuevo)
   - Models/DTOs/FloorMetricsDto.cs (Nuevo)
   - Client/Layout/FloorLayout.razor (Nuevo)
   - Client/Pages/Production/FloorMode.razor (Nuevo)
   - Client/Components/KpiCard.razor (Nuevo/Refactorizado)
   - Client/Program.cs (Configuración de SignalR)