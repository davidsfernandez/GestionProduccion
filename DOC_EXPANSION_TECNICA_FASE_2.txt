# Expansión Técnica de Requisitos - Fase 2 ERP

## Módulo 1: Autenticación y Seguridad
- **Refresh Token Rotation:** El sistema invalidará tokens viejos ante cada renovación para prevenir ataques de replay.
- **Persistent Sessions:** Configuración de LocalStorage con expiración deslizante (sliding expiration).
- **Security Headers:** Implementación de políticas de CORS y Headers de seguridad para el despliegue en IIS.

## Módulo 2: Inteligencia de Producto (Core)
- **Weighted Moving Average:** Algoritmo para la memoria de producción: `(Peso_Historial * Media_Antigua + Peso_Actual * Media_Nueva) / (Total_Pesos)`.
- **SKU Uniqueness:** Validación estricta a nivel de DB mediante índices compuestos (ProductId + Color + Size).
- **PDF Engine:** Uso de QuestPDF con inyección de CSS/Styles definidos en la configuración del sistema.

## Módulo 3: SignalR y BI
- **Hub de Producción:** Canal específico para TVs (`FloorHub`) y canal para Gerencia (`AdminHub`).
- **Data Pruning:** Las métricas del dashboard se pre-calcularán mediante vistas materializadas o caché de servidor para evitar latencia.

## Módulo 4: Calidad y Tareas
- **Image Compression:** Algoritmo en JS (Frontend) para redimensionar imágenes antes del payload.
- **SLA Engine:** Lógica de cálculo de proximidad de fecha límite: `Porcentaje_Progreso_Tiempo = (Ahora - Inicio) / (Limite - Inicio)`.

## Módulo 5: Motor Financiero
- **Costo Minuto:** Cálculo basado en (Sueldos Equipo + Costos Fijos / 22 días / 8 horas).
- **Análisis de Desviación:** Reporte automático de "Alertas de Rentabilidad" cuando el costo real supera el estimado en un >15%.

## Módulo 6: Reglas de Bonificación
- **Logic Engine:** Procesador de reglas booleanas (IF Efficiency > X AND Defect < Y THEN Bonus = Z).
- **Recibo de Pago:** Documento auditable que muestra la traza del cálculo para evitar disputas con los equipos.
